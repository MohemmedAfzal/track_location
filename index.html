<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Track IP & Location (Global)</title>
</head>
<body>
<h2>Click the button to store your IP and Location globally</h2>
<button onclick="captureDetails()">Store My Location</button>

<p id="info"></p>

<script>
    function captureDetails() {
        fetch('https://api64.ipify.org?format=json')
            .then(response => response.json())
            .then(data => {
                let userIP = data.ip;

                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(position => {
                        let lat = position.coords.latitude;
                        let lon = position.coords.longitude;
                        let timestamp = new Date().toLocaleString();

                        document.getElementById('info').innerHTML = `Stored IP: ${userIP} <br> Latitude: ${lat}, Longitude: ${lon} <br> Timestamp: ${timestamp}`;

                        let requestData = {ip: userIP, latitude: lat, longitude: lon};

                        // fetch("https://script.google.com/macros/s/AKfycbywPFEeYO2_19pEBW5ubz66UApedOV75a-n_7oq1VGOQrI-NerTn_lOo7IsnfYVqM4/exec", {
                        //     method: "POST",
                        //     headers: { "Content-Type": "application/json" },
                        //     body: JSON.stringify(requestData)
                        // });
                        fetch("https://script.google.com/macros/s/AKfycbywPFEeYO2_19pEBW5ubz66UApedOV75a-n_7oq1VGOQrI-NerTn_lOo7IsnfYVqM4/exec", {
                            method: "POST",
                            headers: {"Content-Type": "application/json"},
                            mode: "no-cors",
                            body: JSON.stringify(requestData)
                        })
                            .then(response => console.log("Request sent, but no response due to no-cors"))
                            .catch(error => console.error("Error:", error));
                    // }, () => {
                    //     alert("Geolocation access denied. Enable location to proceed.");
                    });
                } else {
                    alert("Geolocation is not supported in this browser.");
                }
            });
    }
</script>
</body>
</html>